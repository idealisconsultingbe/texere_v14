<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="reception_and_release_assets" inherit_id="web.report_assets_common">
        <xpath expr="." position="inside">
            <link rel="stylesheet" type="text/css" href="/reception_and_release_management/static/src/css/report_reception_and_release.css"/>
        </xpath>
    </template>

    <template id="report_lot_reception_and_release">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="lang" t-value="doc.company_id.partner_id.lang"/>
                <t t-call="reception_and_release_management.report_lot_reception_and_release_document" t-lang="lang"/>
            </t>
        </t>
    </template>

    <template id="report_lot_reception_and_release_document">
        <t t-set="document_title">
            <t t-if="doc.type == 'rc_without_qc'">
                RC without QC reception and release form
            </t>
            <t t-elif="doc.type == 'rc_with_qc'">
                RC with QC reception and release form
            </t>
            <t t-else="">
                QC results for RC
            </t>
        </t>
        <t t-call="reception_and_release_management.reception_and_release_company_external_layout">
            <div class="page">

                <div class="col-12">

                    <table class="coa-table p-05 bbr-gray th-whitesmoke">
                        <tbody>
                            <tr>
                                <th class="text-center" style="background-color: DarkGray;" colspan="4"><h2 class="m-0 fs-13-rem">RC Information</h2></th>
                            </tr>
                            <tr>
                                <th width="25%">Product name</th>
                                <td width="25%"><span t-field="doc.product_id.name"/></td>
                                <th width="25%">Order form#</th>
                                <td width="25%"><span t-field="doc.purchase_id.name"/></td>
                            </tr>
                            <tr>
                                <th>TEXERE's ID</th>
                                <td><span t-field="doc.lot_id.name"/></td>
                                <th>QMS Specifications #</th>
                                <td>OP.1.1_SPE_
                                    <t t-if="doc.specification_reference">
                                        <span t-field="doc.specification_reference"/>
                                    </t>
                                    <t t-else="">
                                        _ _ _ _ / _ _
                                    </t>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <table class="coa-table p-05 bbr-gray th-whitesmoke">
                        <tbody>
                            <tr>
                                <th class="text-center" style="background-color: DarkGray;" colspan="4"><h2 class="m-0 fs-13-rem">Reception</h2></th>
                            </tr>
                            <tr>
                                <th width="25%">Arrival date</th>
                                <td width="25%">
                                    <t t-if="doc.arrival_date">
                                        <span t-field="doc.arrival_date"/>
                                    </t>
                                    <t t-else="">
                                        _ _ / _ _ / _ _ _ _
                                    </t>
                                </td>
                                <th width="25%">Expiry date</th>
                                <td width="25%">
                                    <t t-if="doc.expiration_date">
                                        <span t-field="doc.expiration_date"/>
                                    </t>
                                    <t t-else="">
                                        _ _ / _ _ / _ _ _ _ <input type="checkbox"/>&amp;nbsp;N/A
                                    </t>
                                </td>
                            </tr>
                            <tr>
                                <th>Quantity &amp; unit<t t-if="doc.type == 'rc_with_qc'"> (A)</t></th>
                                <td>
                                    <t t-if="doc.product_qty &gt; 0">
                                        <span t-field="doc.product_qty"/> <span t-field="doc.product_uom_id.name"/>
                                    </t>
                                    <t t-else="">&amp;nbsp;</t>
                                </td>
                                <th>Packaging</th>
                                <td>
                                    <t t-if="doc.packaging_state">
                                        <span t-if="doc.packaging_state and doc.packaging_state == 'good'"><input type="checkbox" checked="checked"/> Ok</span>
                                        <span t-elif="doc.packaging_state and doc.packaging_state == 'damaged'"><input type="checkbox" checked="checked"/> Not Ok</span>
                                    </t>
                                    <t t-else="">
                                        <ul class="no-marker-style inline-style">
                                            <li><input type="checkbox"/>&amp;nbsp;OK</li>
                                            <li> / </li>
                                            <li><input type="checkbox"/>&amp;nbsp;Not Ok</li>
                                        </ul>
                                    </t>
                                </td>
                            </tr>
                            <tr>
                                <th>Supplier</th>
                                <td><span t-if="doc.partner_id" t-field="doc.partner_id.name"/></td>
                                <th>Manufacturer</th>
                                <td>&amp;nbsp;</td>
                            </tr>
                            <tr>
                                <th>Supplier reference</th>
                                <td><span t-field="doc.seller_product_code"/></td>
                                <th>Supplier batch</th>
                                <td>&amp;nbsp;</td>
                            </tr>
                            <tr>
                                <th rowspan="2">Quantity reconciliation</th>
                                <td>
                                    Order = delivery note
                                </td>
                                <td colspan="2">
                                    <t t-if="doc.ordered_consistency">
                                        <input type="checkbox" checked="checked"/>&amp;nbsp;<span t-field="doc.ordered_consistency"/>
                                        <span t-if="doc.ordered_consistency == 'not_consistent'"> (details in 'Comments')</span>
                                    </t>
                                    <t t-else="">
                                        <ul class="no-marker-style">
                                            <li><input type="checkbox"/> Consistent</li>
                                            <li><input type="checkbox"/> Not consistent (details in 'Comments')</li>
                                        </ul>
                                    </t>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Delivery note = delivered
                                </td>
                                <td colspan="2">
                                    <t t-if="doc.received_consistency">
                                        <input type="checkbox" checked="checked"/>&amp;nbsp;<span t-field="doc.received_consistency"/>
                                        <span t-if="doc.received_consistency == 'not_consistent'"> (details in 'Comments')</span>
                                    </t>
                                    <t t-else="">
                                        <ul class="no-marker-style">
                                            <li><input type="checkbox"/> Consistent</li>
                                            <li><input type="checkbox"/> Not consistent (details in 'Comments')</li>
                                        </ul>
                                    </t>
                                </td>
                            </tr>
                            <tr>
                                <th>CoA requirement</th>
                                <td colspan="3">
                                    <t t-if="doc.form_appendix">
                                        <input type="checkbox" checked="checked"/>&amp;nbsp;<span t-field="doc.form_appendix"/>
                                        <span t-if="doc.form_appendix == 'yes'"> (Annex 1 of this form - ___ page(s))</span>
                                    </t>
                                    <t t-else="">
                                        <ul class="no-marker-style">
                                            <li><input type="checkbox"/> Yes (Annex 1 of this form - ___ page(s))</li>
                                            <li><input type="checkbox"/> No</li>
                                            <li><input type="checkbox"/> Not applicable</li>
                                        </ul>
                                    </t>
                                </td>
                            </tr>
                            <tr>
                                <th>Temperature log requirement</th>
                                <td colspan="3">
                                    <t t-if="doc.temperature_appendix">
                                        <input type="checkbox" checked="checked"/>&amp;nbsp;<span t-field="doc.temperature_appendix"/>
                                        <span t-if="doc.temperature_appendix == 'yes'"> (Annex 2 of this form - ___ page(s))</span>
                                    </t>
                                    <t t-else="">
                                        <ul class="no-marker-style">
                                            <li><input type="checkbox"/> Yes (Annex 2 of this form - ___ page(s))</li>
                                            <li><input type="checkbox"/> No</li>
                                            <li><input type="checkbox"/> Not applicable</li>
                                        </ul>
                                    </t>
                                </td>
                            </tr>
                            <tr>
                                <th>RC reception status</th>
                                <td colspan="3">
                                    <t t-if="doc.materials_conformity">
                                        <input type="checkbox" checked="checked"/>&amp;nbsp;<span t-field="doc.materials_conformity"/>
                                        <span t-if="doc.materials_conformity == 'criteria_not_met'"> (details in 'Comments')</span>
                                    </t>
                                    <t t-else="">
                                        <ul class="no-marker-style">
                                            <li><input type="checkbox"/> Critera met</li>
                                            <li><input type="checkbox"/> Not applicable</li>
                                            <li><input type="checkbox"/> Criteria not met (details in 'Comments')</li>
                                        </ul>
                                    </t>
                                </td>
                            </tr>
                            <tr>
                                <th>Comments</th>
                                <td colspan="3" style="height: 8rem; vertical-align: top;">
                                    <t t-if="not doc.reception_comment and
                                                not doc.materials_conformity and
                                                not received_consistency and
                                                not ordered_consistency and
                                                not doc.packaging_state">
                                        <input type="checkbox"/>&amp;nbsp;N/A
                                    </t>
                                    <span t-field="doc.reception_comment"/>
                                </td>
                            </tr>
                            <tr>
                                <th rowspan="2">Reception done by</th>
                                <th class="text-center p-0">Date</th>
                                <th class="text-center p-0">Trigram</th>
                                <th class="text-center p-0">Initials</th>
                            </tr>
                            <tr>
                                <td class="h-35 text-center">
                                    <t t-if="doc.receipt_signed_on">
                                        <span t-field="doc.receipt_signed_on"/>
                                    </t>
                                    <t t-else="">
                                        _ _ / _ _ / _ _ _ _
                                    </t>
                                </td>
                                <td class="h-35 text-center">
                                    <t t-if="doc.receipt_signed_by and doc.receipt_signed_by.employee_id">
                                        <span class="text-uppercase" t-field="doc.receipt_signed_by.employee_id.trigram"/>
                                    </t>
                                    <t t-else="">
                                        _ _ _
                                    </t>
                                </td>
                                <td class="h-35 text-center">
                                    <t t-if="doc.receipt_signed_by and doc.receipt_signed_by.sign_initials">
                                        <img style="max-height: 3.5rem;" t-attf-src="data:image/png;base64,#{doc.receipt_signed_by.sign_initials}" alt="Initials"/>
                                    </t>
                                    <t t-else="">&amp;nbsp;</t>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <p style="page-break-after:always;"/>

                    <table t-if="doc.type == 'rc_without_qc'" class="coa-table p-05 bbr-gray th-whitesmoke">
                        <tbody>
                            <tr>
                                <th class="text-center" style="background-color: DarkGray" colspan="4"><h2 class="m-0 fs-13-rem">Label preparation</h2></th>
                            </tr>
                            <tr>
                                <td colspan="2" width="50%" style="border-bottom: none;">
                                    Calculate the number of labels needed:
                                </td>
                                <td class="text-center text-muted" width="50%" rowspan="4" colspan="2">
                                    Stick the label specimen here
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2" class="pl-5" style="border-bottom: none;">
                                    n/3 = _____ + 1 = _____ labels to print
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2" style="border-bottom: none;">
                                    Prepare the labels following the RC label template.
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    Print the labels and stick on specimen on this form.
                                </td>
                            </tr>

                            <tr>
                                <th width="25%" rowspan="2">Label preparation by</th>
                                <th width="25%" class="text-center p-0">Date</th>
                                <th width="25%" class="text-center p-0">Trigram</th>
                                <th width="25%" class="text-center p-0">Initials</th>
                            </tr>
                            <tr>
                                <td class="h-35 text-center">
                                        _ _ / _ _ / _ _ _ _
                                </td>
                                <td class="h-35 text-center">
                                        _ _ _
                                </td>
                                <td class="h-35 text-center">&amp;nbsp;</td>
                            </tr>
                            <tr>
                                <th class="text-center" style="background-color: DarkGray" colspan="4"><h2 class="m-0 fs-13-rem">QA Approval</h2></th>
                            </tr>
                            <tr>
                                <th>Label check</th>
                                <td>
                                    <input type="checkbox"/>&amp;nbsp;Done
                                </td>
                                <th>RC Status</th>
                                <td>
                                    <t t-if="doc.lot_status">
                                        <input type="checkbox" checked="checked"/>&amp;nbsp;
                                        <span t-field="doc.lot_status"/>
                                    </t>
                                    <t t-else="">
                                        <ul class="no-marker-style">
                                            <li><input type="checkbox"/> Released for use</li>
                                            <li><input type="checkbox"/> Rejected</li>
                                        </ul>
                                    </t>
                                </td>
                            </tr>
                            <tr>
                                <th rowspan="2">Approved by</th>
                                <th class="text-center p-0">Date</th>
                                <th class="text-center p-0">Trigram</th>
                                <th class="text-center p-0">Initials</th>
                            </tr>
                            <tr>
                                <td class="h-35 text-center">
                                    <t t-if="doc.signed_on">
                                        <span t-field="doc.signed_on"/>
                                    </t>
                                    <t t-else="">
                                        _ _ / _ _ / _ _ _ _
                                    </t>
                                </td>
                                <td class="h-35 text-center">
                                    <t t-if="doc.signed_by and doc.signed_by.employee_id">
                                        <span class="text-uppercase" t-field="doc.signed_by.employee_id.trigram"/>
                                    </t>
                                    <t t-else="">
                                        _ _ _
                                    </t>
                                </td>
                                <td class="h-35 text-center">
                                    <t t-if="doc.signed_by and doc.signed_by.sign_initials">
                                        <img style="max-height: 3.5rem;" t-attf-src="data:image/png;base64,#{doc.signed_by.sign_initials}" alt="Initials"/>
                                    </t>
                                    <t t-else="">&amp;nbsp;</t>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <table t-if="doc.type == 'rc_without_qc'" class="coa-table p-05 bbr-gray no-break-inside th-whitesmoke">
                        <tbody>
                            <tr>
                                <th class="text-center" style="background-color: DarkGray" colspan="4"><h2 class="m-0 fs-13-rem">Identification, Storage and Doc Update</h2></th>
                            </tr>
                            <tr>
                                <th width="25%" rowspan="3">Identification</th>
                                <td colspan="3" style="border-bottom: none;">
                                    Stick the green labels on the final packaging of conform RC and perform the label reconciliation:
                                </td>
                            </tr>
                            <tr>
                                <td class="text-center" colspan="3" style="border-bottom: none;">
                                    <ul class="no-marker-style inline-style">
                                        <li><input type="checkbox"/>&amp;nbsp;Consistent</li>
                                        <li> / </li>
                                        <li><input type="checkbox"/>&amp;nbsp;Not consistent (details in 'Comments')</li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3">
                                    If applicable, red labels are stuck on not conform RC.
                                </td>
                            </tr>
                            <tr>
                                <th rowspan="3">Storage</th>
                                <td colspan="3" style="border-bottom: none;">
                                    Store the item(s) in the appropriate conditions and temperature:
                                </td>
                            </tr>
                            <tr>
                                <td class="text-center" colspan="3" style="border-bottom: none;">
                                    <t t-if="doc.storage_temperature">
                                        <input type="checkbox" checked="checked"/>&amp;nbsp;
                                        <span t-field="doc.storage_temperature"/>
                                    </t>
                                    <t t-else="">
                                        <ul class="no-marker-style inline-style">
                                            <li>Storage temperature: </li>
                                            <li><input type="checkbox"/> +15/+25°C (RT)</li>
                                            <li> / </li>
                                            <li><input type="checkbox"/> +2/+8°C</li>
                                            <li> / </li>
                                            <li><input type="checkbox"/> -80°C</li>
                                        </ul>
                                    </t>
                                </td>
                            </tr>
                            <tr>
                                <td class="text-center" colspan="3">
                                    Storage location:
                                    <t t-if="doc.items_stored and doc.storage_location"><span t-field="doc.storage_location"/></t>
                                    <t t-else=""> _______________________________</t>
                                </td>
                            </tr>
                            <tr>
                                <th>Doc update</th>
                                <td colspan="3">
                                    Complete the OP.1.2_TAB_002 Table for stock management for reagents and consumables.
                                </td>
                            </tr>
                            <tr>
                                <th>Comments</th>
                                <td colspan="3" style="height: 8rem; vertical-align: top !important;">
                                    <input type="checkbox"/>&amp;nbsp;N/A
                                </td>
                            </tr>
                            <tr>
                                <th width="25%" rowspan="2">Identified by</th>
                                <th width="25%" class="text-center p-0">Date</th>
                                <th width="25%" class="text-center p-0">Trigram</th>
                                <th width="25%" class="text-center p-0">Initials</th>
                            </tr>
                            <tr>
                                <td class="h-35 text-center">
                                    _ _ / _ _ / _ _ _ _
                                </td>
                                <td class="h-35 text-center">
                                    _ _ _
                                </td>
                                <td class="h-35 text-center">
                                    &amp;nbsp;
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <table t-if="doc.type == 'rc_with_qc'" class="coa-table p-05 bbr-gray no-break-inside th-whitesmoke">
                        <tbody>
                            <tr>
                                <th class="text-center" style="background-color: DarkGray" colspan="5"><h2 class="m-0 fs-13-rem">QC Tests Follow-Up</h2></th>
                            </tr>
                            <tr>
                                <td colspan="5">Print and fill in the QC results for RC (OP.1.2_FOR_011) and then, complete the table below.</td>
                            </tr>
                            <tr>
                                <th class="text-center" width="20%">Annex #</th>
                                <th class="text-center" width="20%">Tested quantity</th>
                                <th class="text-center" width="20%">Released quantity</th>
                                <th class="text-center" width="20%">Date</th>
                                <th class="text-center" width="20%">Trigram</th>
                            </tr>
                            <tr t-if="not doc.child_ids" t-foreach="range(15)" t-as="row">
                                <td>&amp;nbsp;</td>
                                <td>&amp;nbsp;</td>
                                <td>&amp;nbsp;</td>
                                <td>&amp;nbsp;</td>
                                <td>&amp;nbsp;</td>
                            </tr>
                            <tr>
                                <td><strong>Total (B)</strong></td>
                                <td class="text-right">
                                    <t t-if="doc.total_qty_tested &gt; 0">
                                        <span t-field="doc.total_qty_tested"/>
                                    </t>
                                    <t t-else="">
                                        &amp;nbsp;
                                    </t>
                                </td>
                                <td colspan="3" style="background-color: LightGray;"/>
                            </tr>
                        </tbody>
                    </table>

                    <table t-if="doc.type == 'rc_with_qc'" class="coa-table p-05 bbr-gray no-break-inside th-whitesmoke">
                        <tbody>
                            <tr>
                                <th class="text-center" style="background-color: DarkGray" colspan="4">
                                    <h2 class="m-0 fs-13-rem">R&amp;R Closure</h2>
                                    <div class="text-center">** To fill at the last set of items tested **</div>
                                </th>
                            </tr>
                            <tr>
                                <th width="25%">Reconciliation</th>
                                <td width="25%">Verify that: A = B</td>
                                <td colspan="2">
                                    <t t-if="doc.reconciliation_consistency">
                                        <input type="checkbox" checked="checked"/>&amp;nbsp;
                                        <span t-field="doc.reconciliation_consistency"/>
                                    </t>
                                    <t t-else="">
                                        <ul class="no-marker-style">
                                            <li><input type="checkbox"/>&amp;nbsp;Consistent</li>
                                            <li><input type="checkbox"/>&amp;nbsp;Not consistent (details in 'Comments')</li>
                                        </ul>
                                    </t>
                                </td>
                            </tr>
                            <tr>
                                <th>Comments</th>
                                <td colspan="3" style="height: 8rem; vertical-align: top;">
                                    <t t-if="not doc.reconciliation_comment and not reconciliation_consistency">
                                        <input type="checkbox"/>&amp;nbsp;N/A
                                    </t>
                                    <span t-field="doc.reconciliation_comment"/>
                                </td>
                            </tr>
                            <tr>
                                <th width="25%" style="border-bottom: none;"/>
                                <th width="25%" class="text-center p-0">Date</th>
                                <th width="25%" class="text-center p-0">Trigram</th>
                                <th width="25%" class="text-center p-0">Initials</th>
                            </tr>
                            <tr>
                                <th>Final check by Operator</th>
                                <td class="h-35 text-center">
                                    _ _ / _ _ / _ _ _ _
                                </td>
                                <td class="h-35 text-center">
                                    _ _ _
                                </td>
                                <td class="h-35 text-center">
                                    &amp;nbsp;
                                </td>
                            </tr>
                            <tr>
                                <th>Final check by QA</th>
                                <td class="h-35 text-center">
                                    <t t-if="doc.closed_on">
                                        <span t-field="doc.closed_on"/>
                                    </t>
                                    <t t-else="">
                                        _ _ / _ _ / _ _ _ _
                                    </t>
                                </td>
                                <td class="h-35 text-center">
                                     <t t-if="doc.closed_by and doc.closed_by.employee_id">
                                        <span class="text-uppercase" t-field="doc.closed_by.employee_id.trigram"/>
                                    </t>
                                    <t t-else="">
                                        _ _ _
                                    </t>
                                </td>
                                <td class="h-35 text-center">
                                    <t t-if="doc.closed_by and doc.closed_by.sign_initials">
                                        <img style="max-height: 3.5rem;" t-attf-src="data:image/png;base64,#{doc.closed_by.sign_initials}" alt="Initials"/>
                                    </t>
                                    <t t-else="">&amp;nbsp;</t>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                </div>
            </div>
        </t>
    </template>

</odoo>
